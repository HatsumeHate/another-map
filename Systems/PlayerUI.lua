---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by MSI.
--- DateTime: 07.05.2021 3:45
---
do

    PlayerUI = nil
    local PlayerGlobeHpValue
    local PlayerGlobeMpValue
    local hp_globe_textures
    local mp_globe_textures
    LevelUpFrameTrigger = nil



    local function CreateAbilityBar(to)
        local frame = BlzCreateFrameByType("BACKDROP", "abc", to, "", 0)

            BlzFrameSetPoint(frame, FRAMEPOINT_LEFT, to, FRAMEPOINT_RIGHT, 0., 0.)
            BlzFrameSetSize(frame, 0.15, 0.07)
            BlzFrameSetTexture(frame, "war3mapImported\\OBRAML.blp", 0, true)
            BlzFrameSetVisible(frame, true)

        return frame
    end


    function ReturnFPS()
        local fps = BlzGetFrameByName("ResourceBarFrame", 0)
        BlzFrameSetVisible(fps, true)
        BlzFrameClearAllPoints(fps)
        BlzFrameSetAbsPoint(fps, FRAMEPOINT_CENTER, 0.88, 0.62)
    end

    function CreateUIChargesBorder(parent)
        local charges = {}
        local border = BlzCreateFrameByType("BACKDROP", "charge", parent, "", 0)
        local text = BlzCreateFrameByType("TEXT", "charge", border, "", 0)

            charges = { border = border, text = text }
            BlzFrameSetPoint(border, FRAMEPOINT_BOTTOMLEFT, parent, FRAMEPOINT_BOTTOMLEFT, 0.002, 0.002)
            BlzFrameSetSize(border, 0.012, 0.012)
            BlzFrameSetTexture(border, "GUI\\ChargesTexture.blp", 0, true)
            BlzFrameSetPoint(text, FRAMEPOINT_CENTER, border, FRAMEPOINT_CENTER, 0.,0.)
            BlzFrameSetVisible(border, false)
            BlzFrameSetText(text, "")

        return charges
    end


    function CreateUIElement(path, x, y, point, scale, size_x, size_y, parent)
        local frame = BlzCreateFrameByType("SIMPLESTATUSBAR", "aasmfmama", parent or GAME_UI, "", 0)
            BlzFrameClearAllPoints(frame)
            BlzFrameSetTexture(frame, path, 0, true)
            BlzFrameSetAbsPoint(frame, point, x, y)
            BlzFrameSetValue(frame, 100)
            BlzFrameSetScale(frame, scale)
            BlzFrameSetSize(frame, size_x, size_y)
        return frame
    end

    function CreateUIBorder(frame, offset)
        local border = BlzCreateFrameByType("BACKDROP", "aaa", GAME_UI, "", 0)
            BlzFrameSetTexture(border, "DiabolicUI_Button_64x64_Border.tga", 0, true)
            BlzFrameSetScale(border, 1.)
            BlzFrameSetPoint(border, FRAMEPOINT_TOPRIGHT, frame, FRAMEPOINT_TOPRIGHT, offset, offset)
            BlzFrameSetPoint(border, FRAMEPOINT_BOTTOMLEFT, frame, FRAMEPOINT_BOTTOMLEFT, -offset, -offset)
        return border
    end



    function TurnOffOriginUI()

        BlzHideOriginFrames(true)
        BlzFrameSetVisible(BlzGetFrameByName("UpperButtonBarFrame",0),true)
        --RegisterDecorator(BlzGetFrameByName("UpperButtonBarFrame", 0), FRAMEPOINT_CENTER, 0.88, 0.82)
        BlzFrameSetAbsPoint(BlzGetFrameByName("ConsoleUIBackdrop", 0), FRAMEPOINT_TOPRIGHT, 0, -0, 8)
        BlzFrameSetVisible(BlzFrameGetChild(BlzGetFrameByName("ConsoleUI", 0), 5), false)

            for i = 0, 3 do
                BlzFrameSetVisible(BlzGetOriginFrame(ORIGIN_FRAME_SYSTEM_BUTTON, i), true)
            end


        BlzFrameSetVisible(BlzGetOriginFrame(ORIGIN_FRAME_MINIMAP, 0), false)
        BlzFrameSetVisible(BlzGetOriginFrame(ORIGIN_FRAME_UNIT_MSG, 0), true)
        ReturnFPS()

    end


    function ShowPlayerUI(player)
        local inv_panel = BlzFrameGetParent(BlzGetFrameByName("SimpleInfoPanelUnitDetail",0))
        local minimap = BlzGetOriginFrame(ORIGIN_FRAME_MINIMAP, 0)
        local command_buttons = {}
        local item_buttons = {}

        for i = 1, 6 do
            item_buttons[i] = BlzGetOriginFrame(ORIGIN_FRAME_ITEM_BUTTON, i-1)
        end

        for i = 6, 11 do
            command_buttons[i] = BlzGetOriginFrame(ORIGIN_FRAME_ITEM_BUTTON, i)
        end

        if GetLocalPlayer() == Player(player-1) then
            for i = 1, 6 do
                BlzFrameSetVisible(item_buttons[i-1], true)
            end

            BlzFrameSetVisible(PlayerUI.xp_bar, true)

            for i = 6, 11 do
                BlzFrameSetVisible(command_buttons[i], true)
            end

            for i = 1, 6 do
                BlzFrameSetVisible(PlayerUI.skill_button_borders[i], true)
                BlzFrameSetVisible(PlayerUI.skill_button_hotkey[i], true)
            end

            for i = 1, 6 do BlzFrameSetVisible(PlayerUI.button_borders[i], true) end

            BlzFrameSetVisible(PlayerUI.hp_text_frame, true)
            BlzFrameSetVisible(PlayerUI.mp_text_frame, true)

            BlzFrameSetVisible(inv_panel, true)

            for i = 1, 6 do
                BlzFrameSetVisible(PlayerUI.inventory_borders[i], true)
            end

            BlzFrameSetVisible(PlayerUI.gold_backdrop, true)
            BlzFrameSetVisible(PlayerUI.skull_decorator, true)
            BlzFrameSetVisible(minimap, true)
            BlzFrameSetVisible(PlayerUI.minimap_border, true)

        end


    end


    function ReloadPlayerUIFrames()

        TurnOffOriginUI()

        for player = 1, 6 do
            if PlayerHero[player] then
                PlayerUI.xp_bar = BlzCreateSimpleFrame("MyBar", GAME_UI, 0)
                BlzFrameClearAllPoints(PlayerUI.xp_bar)
                BlzFrameSetAbsPoint(PlayerUI.xp_bar, FRAMEPOINT_CENTER, 0.4, 0.056)
                BlzFrameSetTexture(PlayerUI.xp_bar, "Replaceabletextures\\Teamcolor\\Teamcolor09.blp", 0, true)
                BlzFrameSetSize(PlayerUI.xp_bar, 0.495, 0.006)
                BlzFrameSetScale(PlayerUI.xp_bar, 1.)
                PlayerUI.xp_bar_text = BlzGetFrameByName("MyBarText", 0)
                BlzFrameSetText(PlayerUI.xp_bar_text, "")
                BlzFrameSetValue(PlayerUI.xp_bar, 0)


                PlayerUI.action_bar = CreateUIElement("DiabolicUI_ActionBarArt1BarXP.tga", 0.4, -0.006, FRAMEPOINT_BOTTOM, 0.78, 1., 0.25, PlayerUI.xp_bar)

                PlayerUI.hp_globe_backdrop = CreateUIElement("DiabolicUI_PlayerGlobes_150x150_Backdrop.tga", 0.083, 0.07, FRAMEPOINT_CENTER, 0.206, 1., 1., PlayerUI.action_bar)
                PlayerUI.mp_globe_backdrop = CreateUIElement("DiabolicUI_PlayerGlobes_150x150_Backdrop.tga", 0.717, 0.07, FRAMEPOINT_CENTER, 0.206, 1., 1., PlayerUI.action_bar)

                PlayerUI.hp_globe = CreateUIElement("UI\\globe_empty.blp", 0.083, 0.07, FRAMEPOINT_CENTER, 0.119, 1., 1., PlayerUI.hp_globe_backdrop)
                PlayerUI.mp_globe = CreateUIElement("UI\\globe_empty.blp", 0.717, 0.07, FRAMEPOINT_CENTER, 0.119, 1., 1., PlayerUI.mp_globe_backdrop)

                PlayerUI.hp_globe_shade = CreateUIElement("DiabolicUI_HealthGlobe512x512_Shade.tga", 0.083, 0.07, FRAMEPOINT_CENTER, 0.119, 1., 1., PlayerUI.hp_globe)
                PlayerUI.mp_globe_shade = CreateUIElement("DiabolicUI_HealthGlobe512x512_Shade.tga", 0.717, 0.07, FRAMEPOINT_CENTER, 0.119, 1., 1., PlayerUI.mp_globe)
                BlzFrameSetAllPoints(PlayerUI.hp_globe_shade, PlayerUI.hp_globe)
                BlzFrameSetAllPoints(PlayerUI.mp_globe_shade, PlayerUI.mp_globe)

                BlzFrameSetVertexColor(PlayerUI.hp_globe_shade, BlzConvertColor(145, 255, 255, 255))
                BlzFrameSetVertexColor(PlayerUI.mp_globe_shade, BlzConvertColor(145, 255, 255, 255))

                PlayerUI.hp_globe_border = CreateUIElement("DiabolicUI_PlayerGlobes_150x150_Border.tga", 0.083, 0.07, FRAMEPOINT_CENTER, 0.206, 1., 1., PlayerUI.hp_globe_shade)
                PlayerUI.mp_globe_border = CreateUIElement("DiabolicUI_PlayerGlobes_150x150_Border.tga", 0.717, 0.07, FRAMEPOINT_CENTER, 0.206, 1., 1., PlayerUI.mp_globe_shade)
                PlayerUI.demon_border = CreateUIElement("DiabolicUI_Artwork_Demon.tga", -0.01, 0.093, FRAMEPOINT_CENTER, 0.2, 1., 1., PlayerUI.hp_globe_border)
                PlayerUI.angel_border = CreateUIElement("DiabolicUI_Artwork_Angel.tga", 0.81, 0.093, FRAMEPOINT_CENTER, 0.2, 1., 1., PlayerUI.mp_globe_border)

                BlzEnableUIAutoPosition(false)
                for i = 0, 11 do
                    BlzFrameClearAllPoints(BlzGetFrameByName("CommandButton_".. i, 0))
                    BlzFrameSetPoint(BlzGetFrameByName("CommandButton_".. i, 0), FRAMEPOINT_TOPRIGHT, WORLD_FRAME, FRAMEPOINT_TOPRIGHT, 0.064, 0.064)
                end

                local button = BlzGetFrameByName("CommandButton_10", 0)
                BlzFrameClearAllPoints(button)
                BlzFrameSetPoint(button, FRAMEPOINT_RIGHT, PlayerUI.action_bar, FRAMEPOINT_BOTTOM, -0.003, 0.0345)
                PlayerUI.skill_button_hotkey[1] = CreateSimpleChargesText(button, "E", 0.9, 0.9, 0., 0., GAME_UI)
                PlayerUI.skill_button_borders[1] = CreateUIBorder(button, 0.0035)

                button = BlzGetFrameByName("CommandButton_9", 0)
                BlzFrameClearAllPoints(button)
                BlzFrameSetPoint(button, FRAMEPOINT_RIGHT, BlzGetFrameByName("CommandButton_10", 0), FRAMEPOINT_LEFT, -0.006, 0.)
                PlayerUI.skill_button_hotkey[2] = CreateSimpleChargesText(button, "W", 0.9, 0.9, 0., 0., GAME_UI)
                PlayerUI.skill_button_borders[2] = CreateUIBorder(button, 0.0035)


                button = BlzGetFrameByName("CommandButton_8", 0)
                BlzFrameClearAllPoints(button)
                BlzFrameSetPoint(button, FRAMEPOINT_RIGHT, BlzGetFrameByName("CommandButton_9", 0), FRAMEPOINT_LEFT, -0.006, 0.)
                PlayerUI.skill_button_hotkey[3] = CreateSimpleChargesText(button, "Q", 0.9, 0.9, 0., 0., GAME_UI)
                PlayerUI.skill_button_borders[3] = CreateUIBorder(button, 0.0035)


                button = BlzGetFrameByName("CommandButton_11", 0)
                BlzFrameClearAllPoints(button)
                BlzFrameSetPoint(button, FRAMEPOINT_LEFT, PlayerUI.action_bar, FRAMEPOINT_BOTTOM, 0.003, 0.0345)
                PlayerUI.skill_button_hotkey[4] = CreateSimpleChargesText(button, "R", 0.9, 0.9, 0., 0., GAME_UI)
                PlayerUI.skill_button_borders[4] = CreateUIBorder(button, 0.0035)

                button = BlzGetFrameByName("CommandButton_6", 0)
                BlzFrameClearAllPoints(button)
                BlzFrameSetPoint(button, FRAMEPOINT_LEFT, BlzGetFrameByName("CommandButton_11", 0), FRAMEPOINT_RIGHT, 0.006, 0.)
                PlayerUI.skill_button_hotkey[5] = CreateSimpleChargesText(button, "D", 0.9, 0.9, 0., 0., GAME_UI)
                PlayerUI.skill_button_borders[5] = CreateUIBorder(button, 0.0035)

                button = BlzGetFrameByName("CommandButton_7", 0)
                BlzFrameClearAllPoints(button)
                BlzFrameSetPoint(button, FRAMEPOINT_LEFT, BlzGetFrameByName("CommandButton_6", 0), FRAMEPOINT_RIGHT, 0.006, 0.)
                PlayerUI.skill_button_hotkey[6] = CreateSimpleChargesText(button, "F", 0.9, 0.9, 0., 0., GAME_UI)
                PlayerUI.skill_button_borders[6] = CreateUIBorder(button, 0.0035)


                for i = 1, 6 do
                    BlzFrameSetVisible(PlayerUI.skill_button_borders[i], false)
                    BlzFrameSetVisible(PlayerUI.skill_button_hotkey[i], false)
                end


                local inventory_button_0 = BlzGetFrameByName("InventoryButton_0", 0)

                local inv_panel = BlzFrameGetParent(BlzGetFrameByName("SimpleInfoPanelUnitDetail",0))
                BlzFrameSetAbsPoint(inv_panel, FRAMEPOINT_TOP, 0.4, -0.1)
                BlzFrameSetAbsPoint(BlzGetFrameByName("SimpleInfoPanelUnitDetail",0), FRAMEPOINT_TOP, 0.4, -0.1)
                BlzFrameSetAbsPoint(BlzGetFrameByName("InventoryCoverTexture",0), FRAMEPOINT_TOP, 0.4, -0.1)
                BlzFrameSetAbsPoint(BlzGetFrameByName("SimpleInventoryCover",0), FRAMEPOINT_TOP, 0.4, -0.1)
                BlzFrameSetAbsPoint(BlzGetFrameByName("InventoryText",0), FRAMEPOINT_TOP, 0.4, -0.1)


                for i = 0, 5 do
                    BlzFrameSetVisible(BlzGetOriginFrame(ORIGIN_FRAME_ITEM_BUTTON, i), true)
                    BlzFrameSetVisible(BlzGetFrameByName("InventoryButton_" .. i, 0), true)
                end


                local last_element = CreateUIElement("DiabolicUI_Button_64x64_BackdropBag.tga", 0.33, 0.097, FRAMEPOINT_CENTER, 1., 0.032, 0.032, PlayerUI.action_bar)
                BlzFrameSetLevel(last_element, 0)
                BlzFrameClearAllPoints(inventory_button_0)
                BlzFrameSetAbsPoint(inventory_button_0, FRAMEPOINT_CENTER, 0.322, 0.077)
                BlzFrameClearAllPoints(last_element)
                BlzFrameSetAllPoints(last_element, inventory_button_0)
                PlayerUI.inventory_borders[6] = CreateUIBorder(inventory_button_0, 0.)
                local last_border


                for i = 1, 5 do
                    local inv_button = BlzGetFrameByName("InventoryButton_" .. i, 0)
                    local element = CreateUIElement("DiabolicUI_Button_64x64_BackdropBag.tga", 0.314, 0.097, FRAMEPOINT_CENTER, 1., 0.032, 0.032, PlayerUI.action_bar)
                    BlzFrameSetLevel(element, 0)
                    BlzFrameClearAllPoints(inv_button)
                    BlzFrameClearAllPoints(element)
                    BlzFrameSetPoint(inv_button, FRAMEPOINT_LEFT, BlzGetFrameByName("InventoryButton_" .. i-1, 0), FRAMEPOINT_RIGHT, 0., 0.)
                    last_border = CreateUIBorder(inv_button, 0.)
                    PlayerUI.inventory_borders[i] = last_border
                    BlzFrameSetAllPoints(element, inv_button)
                    last_element = element
                end


                for i = 1, 6 do
                    BlzFrameSetVisible(PlayerUI.inventory_borders[i], false)
                end


                PlayerUI.skull_decorator = BlzCreateFrameByType("BACKDROP", "aaa", GAME_UI, "", 0)
                BlzFrameSetTexture(PlayerUI.skull_decorator, "DiabolicUI_Artwork_Skull.tga", 0, true)
                BlzFrameSetScale(PlayerUI.skull_decorator, 0.33)
                BlzFrameClearAllPoints(PlayerUI.skull_decorator)
                BlzFrameSetAbsPoint(PlayerUI.skull_decorator, FRAMEPOINT_CENTER, 0.4, 0.093)
                BlzFrameSetSize(PlayerUI.skull_decorator, 1., 0.25)
                BlzFrameSetVisible(PlayerUI.skull_decorator, false)

                local buff_bar = BlzGetOriginFrame(ORIGIN_FRAME_UNIT_PANEL_BUFF_BAR, 0)
                BlzFrameSetParent(buff_bar, PlayerUI.xp_bar)
                BlzFrameClearAllPoints(buff_bar)
                BlzFrameSetAbsPoint(buff_bar, FRAMEPOINT_CENTER, 0.23, 0.086)
                BlzFrameSetVisible(buff_bar, true)
                BlzFrameSetText(BlzGetOriginFrame(ORIGIN_FRAME_UNIT_PANEL_BUFF_BAR_LABEL, 0), "")


                local text_frame = BlzCreateFrameByType("TEXT", "aaa", GAME_UI, "StandardLabelTextTemplate", 0)
                BlzFrameClearAllPoints(text_frame)
                BlzFrameSetPoint(text_frame, FRAMEPOINT_BOTTOM, PlayerUI.hp_globe_border, FRAMEPOINT_CENTER, 0.0, 0.068)
                BlzFrameSetTextColor(text_frame, BlzConvertColor(0, 255, 255, 255))
                BlzFrameSetText(text_frame, "")
                BlzFrameSetFont(text_frame, "D3font.ttf", 0.013, 0)
                PlayerUI.hp_text_frame = text_frame
                BlzFrameSetVisible(PlayerUI.hp_text_frame, false)

                text_frame = BlzCreateFrameByType("TEXT", "aaa", GAME_UI, "StandardLabelTextTemplate", 0)
                BlzFrameClearAllPoints(text_frame)
                BlzFrameSetPoint(text_frame, FRAMEPOINT_BOTTOM, PlayerUI.mp_globe_border, FRAMEPOINT_CENTER, 0.0, 0.068)
                BlzFrameSetTextColor(text_frame, BlzConvertColor(0, 255, 255, 255))
                BlzFrameSetText(text_frame, "")
                BlzFrameSetFont(text_frame, "D3font.ttf", 0.013, 0)
                PlayerUI.mp_text_frame = text_frame
                BlzFrameSetVisible(PlayerUI.mp_text_frame, false)

                local minimap = BlzGetOriginFrame(ORIGIN_FRAME_MINIMAP, 0)
                local minimap_border = BlzCreateFrame('EscMenuBackdropEx', GAME_UI, 0, 0)

                BlzFrameClearAllPoints(minimap)
                --BlzFrameSetVisible(minimap, true)
                BlzFrameSetPoint(minimap, FRAMEPOINT_TOPRIGHT, GAME_UI, FRAMEPOINT_TOPRIGHT, -0.03, 0.)
                BlzFrameSetPoint(minimap_border, FRAMEPOINT_TOPRIGHT, minimap, FRAMEPOINT_TOPRIGHT, 0.008, -0.02)
                BlzFrameSetPoint(minimap_border, FRAMEPOINT_BOTTOMLEFT, minimap, FRAMEPOINT_BOTTOMLEFT, -0.008, 0.019)
                BlzFrameSetVisible(minimap_border, false)
                PlayerUI.minimap_border = minimap_border


                for i = 0, 4 do BlzFrameSetVisible(BlzGetOriginFrame(ORIGIN_FRAME_MINIMAP_BUTTON, i), true) end

                PlayerUI.gold_backdrop = CreateUIElement("DiabolicUI_UIButton_61x55_Normal", 0.581, 0.091, FRAMEPOINT_CENTER, 1., 0.095, 0.04, PlayerUI.action_bar)
                BlzFrameSetVisible(PlayerUI.gold_backdrop, false)
                local gold_text = BlzGetFrameByName("ResourceBarGoldText", 0)
                BlzFrameClearAllPoints(gold_text)
                BlzFrameSetAbsPoint(gold_text, FRAMEPOINT_CENTER, 0.57, 0.09)
                BlzFrameSetTextColor(gold_text, BlzConvertColor(255, 255, 255, 0))

                PlayerUI.level_bar = BlzGetFrameByName("SimpleHeroLevelBar", 0)

                local start_levelup_scale = 0.8
                local end_levelup_scale = 0.55
                local scale_diff = start_levelup_scale - end_levelup_scale

                for i = 1, 6 do
                    PlayerUI.level_up_frame[i] = BlzCreateFrameByType("BACKDROP", "level up name", GAME_UI, "", 0)
                    BlzFrameSetVisible(PlayerUI.level_up_frame[i], false)
                    BlzFrameSetAbsPoint(PlayerUI.level_up_frame[i], FRAMEPOINT_CENTER, 0.4, 0.4)
                    BlzFrameSetSize(PlayerUI.level_up_frame[i], 0.8, 0.44)
                    BlzFrameSetScale(PlayerUI.level_up_frame[i], start_levelup_scale)
                    BlzFrameSetTexture(PlayerUI.level_up_frame[i], "UI\\".. GetLocalString("new_level_ru.blp", "new_level_en.blp"), 0, true)
                end

                PauseTimer(PlayerUI.update_timer)
                DestroyTimer(PlayerUI.update_timer)
                PlayerUI.update_timer = CreateTimer()
                local update_step = 38 / (1. / 0.025)
                local time_delta = 0.3 / 0.025

                PlayerUI.level_bar = BlzGetFrameByName("SimpleHeroLevelBar", 0)
                TimerStart(PlayerUI.update_timer, 0.025, true, function()

                    for i = 1, 6 do
                        if PlayerHero[i] then
                            local current_hp = GetUnitState(PlayerHero[i], UNIT_STATE_LIFE)
                            local max_hp = BlzGetUnitMaxHP(PlayerHero[i])

                            local current_mana = GetUnitState(PlayerHero[i], UNIT_STATE_MANA)
                            local max_mana = BlzGetUnitMaxMana(PlayerHero[i])

                            local current_hp_ratio = math.floor(((current_hp / max_hp) * 100.) + 0.5)
                            local current_mp_ratio = math.floor(((current_mana / max_mana) * 100.) + 0.5)
                            local globe_hp_value = math.floor(PlayerGlobeHpValue[i] + 0.5)
                            local globe_mp_value = math.floor(PlayerGlobeMpValue[i] + 0.5)

                            if globe_hp_value > 100 then globe_hp_value = 100 end
                            if globe_mp_value > 100 then globe_mp_value = 100 end


                                if current_hp_ratio ~= globe_hp_value then
                                    update_step = ((current_hp_ratio - globe_hp_value) / time_delta) * 1.25

                                    PlayerGlobeHpValue[i] = PlayerGlobeHpValue[i] + update_step
                                    globe_hp_value = math.floor(PlayerGlobeHpValue[i] + 0.5)

                                    if GetLocalPlayer() == Player(i - 1) then BlzFrameSetTexture(PlayerUI.hp_globe, hp_globe_textures[globe_hp_value], 0, true) end
                                elseif globe_hp_value == 0 then
                                    PlayerGlobeHpValue[i] = 0
                                    if GetLocalPlayer() == Player(i - 1) then BlzFrameSetTexture(PlayerUI.hp_globe, "UI\\globe_empty.blp", 0, true) end
                                elseif globe_hp_value == 100 then
                                    PlayerGlobeHpValue[i] = 100
                                    if GetLocalPlayer() == Player(i - 1) then BlzFrameSetTexture(PlayerUI.hp_globe, hp_globe_textures[100], 0, true) end
                                end


                                if current_mp_ratio ~= globe_mp_value then
                                    update_step = ((current_mp_ratio - globe_mp_value) / time_delta) * 1.25

                                    PlayerGlobeMpValue[i] = PlayerGlobeMpValue[i] + update_step
                                    globe_mp_value = math.floor(PlayerGlobeMpValue[i] + 0.5)

                                    if GetLocalPlayer() == Player(i - 1) then BlzFrameSetTexture(PlayerUI.mp_globe, mp_globe_textures[globe_mp_value], 0, true) end
                                elseif globe_mp_value == 0 then
                                    PlayerGlobeMpValue[i] = 0
                                    if GetLocalPlayer() == Player(i - 1) then BlzFrameSetTexture(PlayerUI.mp_globe, "UI\\globe_empty.blp", 0, true) end
                                elseif globe_mp_value == 100 then
                                    PlayerGlobeMpValue[i] = 100
                                    if GetLocalPlayer() == Player(i - 1) then BlzFrameSetTexture(PlayerUI.mp_globe, mp_globe_textures[100], 0, true) end
                                end


                                if GetLocalPlayer() == Player(i - 1) then
                                    BlzFrameSetText(PlayerUI.hp_text_frame, math.floor(current_hp + 0.5) .. "/" .. max_hp)
                                    BlzFrameSetText(PlayerUI.mp_text_frame, math.floor(current_mana + 0.5) .. "/" .. max_mana)
                                    if BlzFrameGetValue(PlayerUI.level_bar) < 1. then BlzFrameSetValue(PlayerUI.xp_bar, BlzFrameGetValue(PlayerUI.level_bar) * 100.) end
                                    BlzFrameSetText(PlayerUI.xp_bar_text, "|c00FF5A00" .. (GetHeroXP(PlayerHero[i]) - PlayerLastRequiredEXP[i]) .. "/".. (PlayerRequiredEXP[i] - PlayerLastRequiredEXP[i]) .. "|r")
                                end

                        end
                    end

                end)

                SelectUnitForPlayerSingle(PlayerHero[player], Player(player-1))
                local current_player = player
                DelayAction(0.3, function()

                    for key = 1, 6 do
                        PlayerUI.skill_button_charges[current_player].button[key] = CreateUIChargesBorder(PlayerUI.skill_button_borders[key])
                        BlzFrameSetVisible(PlayerUI.skill_button_charges[current_player].button[key].border, false)
                    end

                    KEYBIND_LIST[KEY_Q].player_charges_frame[current_player] = PlayerUI.skill_button_charges[current_player].button[3]
                    KEYBIND_LIST[KEY_W].player_charges_frame[current_player] = PlayerUI.skill_button_charges[current_player].button[2]
                    KEYBIND_LIST[KEY_E].player_charges_frame[current_player] = PlayerUI.skill_button_charges[current_player].button[1]
                    KEYBIND_LIST[KEY_R].player_charges_frame[current_player] = PlayerUI.skill_button_charges[current_player].button[4]
                    KEYBIND_LIST[KEY_D].player_charges_frame[current_player] = PlayerUI.skill_button_charges[current_player].button[5]
                    KEYBIND_LIST[KEY_F].player_charges_frame[current_player] = PlayerUI.skill_button_charges[current_player].button[6]

                    ShowPlayerUI(current_player)
                    UpdateBindedSkillsData(current_player)
                    local unit_data = GetUnitData(PlayerHero[current_player])

                        if unit_data.equip_point[CHEST_POINT] then
                            local item = unit_data.equip_point[CHEST_POINT].item

                                if item then
                                    EquipItem(PlayerHero[current_player], item, false)
                                    EquipItem(PlayerHero[current_player], item, true)
                                else
                                    SetTexture(PlayerHero[current_player], TEXTURE_ID_EMPTY)
                                end

                        else
                            SetTexture(PlayerHero[current_player], TEXTURE_ID_EMPTY)
                        end

                    PlayerSyncData[current_player] = { [1] = false, [2] = false, [3] = false, [4] = false, [5] = false, [6] = false }
                    FileLoad("CastleRevival\\slot1.txt")
                    FileLoad("CastleRevival\\slot2.txt")
                    FileLoad("CastleRevival\\slot3.txt")
                    FileLoad("CastleRevival\\slot4.txt")
                    FileLoad("CastleRevival\\slot5.txt")
                    --UpdateStashWindow(current_player)

                end)

                EnableGUIForPlayer(player)
                PlayerUI.button_borders = {
                    CreateUIBorder(GlobalButton[player].char_panel_button, 0.),
                    CreateUIBorder(GlobalButton[player].skill_panel_button, 0.),
                    CreateUIBorder(GlobalButton[player].inventory_panel_button, 0.),
                    CreateUIBorder(GlobalButton[player].talents_panel_button, 0.),
                    CreateUIBorder(GlobalButton[player].journal_panel_button, 0.),
                    CreateUIBorder(GlobalButton[player].settings_panel_button, 0.)
                }

                PlayerUI.arrow = CreateSprite("UI\\arrow.mdx", 0.001, GlobalButton[player].skill_panel_button, FRAMEPOINT_BOTTOM, FRAMEPOINT_TOP, 0., 0.01, PlayerUI.button_borders[2])
                PlayerUI.arrow_ability_text = BlzCreateFrameByType("TEXT", "helper", PlayerUI.arrow, "StandardLabelTextTemplate", 0)
                BlzFrameSetFont(PlayerUI.arrow_ability_text, "D3font.ttf", 0.013, 0)
                BlzFrameSetText(PlayerUI.arrow_ability_text, GetLocalString("Выберите способности для использования", "Pick and bind abilities for use"))
                BlzFrameClearAllPoints(PlayerUI.arrow_ability_text)
                BlzFrameSetScale(PlayerUI.arrow_ability_text, 1.)
                BlzFrameSetPoint(PlayerUI.arrow_ability_text, FRAMEPOINT_TOPLEFT, PlayerUI.arrow, FRAMEPOINT_TOPRIGHT, 0.04, 0.1)
                BlzFrameSetTextAlignment(PlayerUI.arrow_ability_text, TEXT_JUSTIFY_CENTER, TEXT_JUSTIFY_MIDDLE)

                if SkillPanelTutorialData[player] then
                    BlzFrameSetVisible(PlayerUI.arrow, true)
                    BlzFrameSetVisible(PlayerUI.arrow_ability_text, true)
                else
                    BlzFrameSetVisible(PlayerUI.arrow, false)
                    BlzFrameSetVisible(PlayerUI.arrow_ability_text, false)
                end

            end
        end


    end


    function CreatePlayerUI()


        TurnOffOriginUI()


        hp_globe_textures = {}
        mp_globe_textures = {}

        for i = 1, 100 do
            if i < 10 then
                hp_globe_textures[i] = "war3mapImported\\globe_hp_0".. i..".blp"
                mp_globe_textures[i] = "war3mapImported\\globe_mp_0".. i..".blp"
            else
                hp_globe_textures[i] = "war3mapImported\\globe_hp_".. i..".blp"
                mp_globe_textures[i] = "war3mapImported\\globe_mp_".. i..".blp"
            end
        end

        PlayerUI = { }

            PlayerUI.xp_bar = BlzCreateSimpleFrame("MyBar", GAME_UI, 0)
            BlzFrameClearAllPoints(PlayerUI.xp_bar)
            BlzFrameSetAbsPoint(PlayerUI.xp_bar, FRAMEPOINT_CENTER, 0.4, 0.056)
            BlzFrameSetTexture(PlayerUI.xp_bar, "Replaceabletextures\\Teamcolor\\Teamcolor09.blp", 0, true)
            BlzFrameSetSize(PlayerUI.xp_bar, 0.495, 0.006)
            BlzFrameSetScale(PlayerUI.xp_bar, 1.)
            PlayerUI.xp_bar_text = BlzGetFrameByName("MyBarText", 0)
            BlzFrameSetText(PlayerUI.xp_bar_text, "")
            BlzFrameSetValue(PlayerUI.xp_bar, 0)

            PlayerUI.action_bar = CreateUIElement("DiabolicUI_ActionBarArt1BarXP.tga", 0.4, -0.006, FRAMEPOINT_BOTTOM, 0.78, 1., 0.25, PlayerUI.xp_bar)

            PlayerUI.hp_globe_backdrop = CreateUIElement("DiabolicUI_PlayerGlobes_150x150_Backdrop.tga", 0.083, 0.07, FRAMEPOINT_CENTER, 0.206, 1., 1., PlayerUI.action_bar)
            PlayerUI.mp_globe_backdrop = CreateUIElement("DiabolicUI_PlayerGlobes_150x150_Backdrop.tga", 0.717, 0.07, FRAMEPOINT_CENTER, 0.206, 1., 1., PlayerUI.action_bar)

            PlayerUI.hp_globe = CreateUIElement("UI\\globe_empty.blp", 0.083, 0.07, FRAMEPOINT_CENTER, 0.119, 1., 1., PlayerUI.hp_globe_backdrop)
            PlayerUI.mp_globe = CreateUIElement("UI\\globe_empty.blp", 0.717, 0.07, FRAMEPOINT_CENTER, 0.119, 1., 1., PlayerUI.mp_globe_backdrop)

            PlayerUI.hp_globe_shade = CreateUIElement("DiabolicUI_HealthGlobe512x512_Shade.tga", 0.083, 0.07, FRAMEPOINT_CENTER, 0.119, 1., 1., PlayerUI.hp_globe)
            PlayerUI.mp_globe_shade = CreateUIElement("DiabolicUI_HealthGlobe512x512_Shade.tga", 0.717, 0.07, FRAMEPOINT_CENTER, 0.119, 1., 1., PlayerUI.mp_globe)
            BlzFrameSetAllPoints(PlayerUI.hp_globe_shade, PlayerUI.hp_globe)
            BlzFrameSetAllPoints(PlayerUI.mp_globe_shade, PlayerUI.mp_globe)

            BlzFrameSetVertexColor(PlayerUI.hp_globe_shade, BlzConvertColor(145, 255, 255, 255))
            BlzFrameSetVertexColor(PlayerUI.mp_globe_shade, BlzConvertColor(145, 255, 255, 255))


            PlayerUI.hp_globe_border = CreateUIElement("DiabolicUI_PlayerGlobes_150x150_Border.tga", 0.083, 0.07, FRAMEPOINT_CENTER, 0.206, 1., 1., PlayerUI.hp_globe_shade)
            PlayerUI.mp_globe_border = CreateUIElement("DiabolicUI_PlayerGlobes_150x150_Border.tga", 0.717, 0.07, FRAMEPOINT_CENTER, 0.206, 1., 1., PlayerUI.mp_globe_shade)
            PlayerUI.demon_border = CreateUIElement("DiabolicUI_Artwork_Demon.tga", -0.01, 0.093, FRAMEPOINT_CENTER, 0.2, 1., 1., PlayerUI.hp_globe_border)
            PlayerUI.angel_border = CreateUIElement("DiabolicUI_Artwork_Angel.tga", 0.81, 0.093, FRAMEPOINT_CENTER, 0.2, 1., 1., PlayerUI.mp_globe_border)

            BlzEnableUIAutoPosition(false)
            for i = 0, 11 do
                BlzFrameClearAllPoints(BlzGetFrameByName("CommandButton_".. i, 0))
                BlzFrameSetPoint(BlzGetFrameByName("CommandButton_".. i, 0), FRAMEPOINT_TOPRIGHT, WORLD_FRAME, FRAMEPOINT_TOPRIGHT, 0.064, 0.064)
            end


            PlayerUI.skill_button_borders = {}
            PlayerUI.skill_button_hotkey = {}
            PlayerUI.skill_button_charges = {}


            local button = BlzGetFrameByName("CommandButton_10", 0)
            BlzFrameClearAllPoints(button)
            BlzFrameSetPoint(button, FRAMEPOINT_RIGHT, PlayerUI.action_bar, FRAMEPOINT_BOTTOM, -0.003, 0.0345)
            PlayerUI.skill_button_hotkey[1] = CreateSimpleChargesText(button, "E", 0.9, 0.9, 0., 0., GAME_UI)
            PlayerUI.skill_button_borders[1] = CreateUIBorder(button, 0.0035)

            button = BlzGetFrameByName("CommandButton_9", 0)
            BlzFrameClearAllPoints(button)
            BlzFrameSetPoint(button, FRAMEPOINT_RIGHT, BlzGetFrameByName("CommandButton_10", 0), FRAMEPOINT_LEFT, -0.006, 0.)
            PlayerUI.skill_button_hotkey[2] = CreateSimpleChargesText(button, "W", 0.9, 0.9, 0., 0., GAME_UI)
            PlayerUI.skill_button_borders[2] = CreateUIBorder(button, 0.0035)


            button = BlzGetFrameByName("CommandButton_8", 0)
            BlzFrameClearAllPoints(button)
            BlzFrameSetPoint(button, FRAMEPOINT_RIGHT, BlzGetFrameByName("CommandButton_9", 0), FRAMEPOINT_LEFT, -0.006, 0.)
            PlayerUI.skill_button_hotkey[3] = CreateSimpleChargesText(button, "Q", 0.9, 0.9, 0., 0., GAME_UI)
            PlayerUI.skill_button_borders[3] = CreateUIBorder(button, 0.0035)



            button = BlzGetFrameByName("CommandButton_11", 0)
            BlzFrameClearAllPoints(button)
            BlzFrameSetPoint(button, FRAMEPOINT_LEFT, PlayerUI.action_bar, FRAMEPOINT_BOTTOM, 0.003, 0.0345)
            PlayerUI.skill_button_hotkey[4] = CreateSimpleChargesText(button, "R", 0.9, 0.9, 0., 0., GAME_UI)
            PlayerUI.skill_button_borders[4] = CreateUIBorder(button, 0.0035)

            button = BlzGetFrameByName("CommandButton_6", 0)
            BlzFrameClearAllPoints(button)
            BlzFrameSetPoint(button, FRAMEPOINT_LEFT, BlzGetFrameByName("CommandButton_11", 0), FRAMEPOINT_RIGHT, 0.006, 0.)
            PlayerUI.skill_button_hotkey[5] = CreateSimpleChargesText(button, "D", 0.9, 0.9, 0., 0., GAME_UI)
            PlayerUI.skill_button_borders[5] = CreateUIBorder(button, 0.0035)

            button = BlzGetFrameByName("CommandButton_7", 0)
            BlzFrameClearAllPoints(button)
            BlzFrameSetPoint(button, FRAMEPOINT_LEFT, BlzGetFrameByName("CommandButton_6", 0), FRAMEPOINT_RIGHT, 0.006, 0.)
            PlayerUI.skill_button_hotkey[6] = CreateSimpleChargesText(button, "F", 0.9, 0.9, 0., 0., GAME_UI)
            PlayerUI.skill_button_borders[6] = CreateUIBorder(button, 0.0035)


            for i = 1, 6 do
                BlzFrameSetVisible(PlayerUI.skill_button_borders[i], false)
                BlzFrameSetVisible(PlayerUI.skill_button_hotkey[i], false)
            end


            local inventory_button_0 = BlzGetFrameByName("InventoryButton_0", 0)

            local inv_panel = BlzFrameGetParent(BlzGetFrameByName("SimpleInfoPanelUnitDetail",0))
            BlzFrameSetAbsPoint(inv_panel, FRAMEPOINT_TOP, 0.4, -0.1)
            BlzFrameSetAbsPoint(BlzGetFrameByName("SimpleInfoPanelUnitDetail",0), FRAMEPOINT_TOP, 0.4, -0.1)
            BlzFrameSetAbsPoint(BlzGetFrameByName("InventoryCoverTexture",0), FRAMEPOINT_TOP, 0.4, -0.1)
            BlzFrameSetAbsPoint(BlzGetFrameByName("SimpleInventoryCover",0), FRAMEPOINT_TOP, 0.4, -0.1)
            BlzFrameSetAbsPoint(BlzGetFrameByName("InventoryText",0), FRAMEPOINT_TOP, 0.4, -0.1)


            for i = 0, 5 do
                BlzFrameSetVisible(BlzGetOriginFrame(ORIGIN_FRAME_ITEM_BUTTON, i), true)
                BlzFrameSetVisible(BlzGetFrameByName("InventoryButton_" .. i, 0), true)
            end

            PlayerUI.inventory_borders = {}
            local last_element = CreateUIElement("DiabolicUI_Button_64x64_BackdropBag.tga", 0.33, 0.097, FRAMEPOINT_CENTER, 1., 0.032, 0.032, PlayerUI.action_bar)
            BlzFrameSetLevel(last_element, 0)
            BlzFrameClearAllPoints(inventory_button_0)
            BlzFrameSetAbsPoint(inventory_button_0, FRAMEPOINT_CENTER, 0.322, 0.077)
            BlzFrameClearAllPoints(last_element)
            BlzFrameSetAllPoints(last_element, inventory_button_0)
            PlayerUI.inventory_borders[6] = CreateUIBorder(inventory_button_0, 0.)
            local last_border


            for i = 1, 5 do
                local inv_button = BlzGetFrameByName("InventoryButton_" .. i, 0)
                local element = CreateUIElement("DiabolicUI_Button_64x64_BackdropBag.tga", 0.314, 0.097, FRAMEPOINT_CENTER, 1., 0.032, 0.032, PlayerUI.action_bar)
                BlzFrameSetLevel(element, 0)
                BlzFrameClearAllPoints(inv_button)
                BlzFrameClearAllPoints(element)
                BlzFrameSetPoint(inv_button, FRAMEPOINT_LEFT, BlzGetFrameByName("InventoryButton_" .. i-1, 0), FRAMEPOINT_RIGHT, 0., 0.)
                last_border = CreateUIBorder(inv_button, 0.)
                PlayerUI.inventory_borders[i] = last_border
                BlzFrameSetAllPoints(element, inv_button)
                last_element = element
            end

            for i = 1, 6 do
                BlzFrameSetVisible(PlayerUI.inventory_borders[i], false)
            end

            PlayerUI.skull_decorator = BlzCreateFrameByType("BACKDROP", "aaa", GAME_UI, "", 0)
            BlzFrameSetTexture(PlayerUI.skull_decorator, "DiabolicUI_Artwork_Skull.tga", 0, true)
            --BlzFrameSetTexture(PlayerUI.skull_decorator, "war3mapImported\\DiabolicUI_Artwork_Skull123.tga", 0, true)
            BlzFrameSetScale(PlayerUI.skull_decorator, 0.33)
            BlzFrameClearAllPoints(PlayerUI.skull_decorator)
            BlzFrameSetAbsPoint(PlayerUI.skull_decorator, FRAMEPOINT_CENTER, 0.4, 0.093)
            BlzFrameSetSize(PlayerUI.skull_decorator, 1., 0.25)
            BlzFrameSetVisible(PlayerUI.skull_decorator, false)


            local buff_bar = BlzGetOriginFrame(ORIGIN_FRAME_UNIT_PANEL_BUFF_BAR, 0)
            BlzFrameSetParent(buff_bar, PlayerUI.xp_bar)
            BlzFrameClearAllPoints(buff_bar)
            BlzFrameSetAbsPoint(buff_bar, FRAMEPOINT_CENTER, 0.23, 0.086)
            BlzFrameSetVisible(buff_bar, true)
            BlzFrameSetText(BlzGetOriginFrame(ORIGIN_FRAME_UNIT_PANEL_BUFF_BAR_LABEL, 0), "")


            local text_frame = BlzCreateFrameByType("TEXT", "aaa", GAME_UI, "StandardLabelTextTemplate", 0)
            BlzFrameClearAllPoints(text_frame)
            BlzFrameSetPoint(text_frame, FRAMEPOINT_BOTTOM, PlayerUI.hp_globe_border, FRAMEPOINT_CENTER, 0.0, 0.068)
            BlzFrameSetTextColor(text_frame, BlzConvertColor(0, 255, 255, 255))
            BlzFrameSetText(text_frame, "")
            BlzFrameSetFont(text_frame, "D3font.ttf", 0.013, 0)
            PlayerUI.hp_text_frame = text_frame
            BlzFrameSetVisible(PlayerUI.hp_text_frame, false)

            text_frame = BlzCreateFrameByType("TEXT", "aaa", GAME_UI, "StandardLabelTextTemplate", 0)
            BlzFrameClearAllPoints(text_frame)
            BlzFrameSetPoint(text_frame, FRAMEPOINT_BOTTOM, PlayerUI.mp_globe_border, FRAMEPOINT_CENTER, 0.0, 0.068)
            BlzFrameSetTextColor(text_frame, BlzConvertColor(0, 255, 255, 255))
            BlzFrameSetText(text_frame, "")
            BlzFrameSetFont(text_frame, "D3font.ttf", 0.013, 0)
            PlayerUI.mp_text_frame = text_frame
            BlzFrameSetVisible(PlayerUI.mp_text_frame, false)

            local minimap = BlzGetOriginFrame(ORIGIN_FRAME_MINIMAP, 0)
            local minimap_border = BlzCreateFrame('EscMenuBackdropEx', GAME_UI, 0, 0)

            BlzFrameClearAllPoints(minimap)
            --BlzFrameSetVisible(minimap, true)
            BlzFrameSetPoint(minimap, FRAMEPOINT_TOPRIGHT, GAME_UI, FRAMEPOINT_TOPRIGHT, -0.03, 0.)
            BlzFrameSetPoint(minimap_border, FRAMEPOINT_TOPRIGHT, minimap, FRAMEPOINT_TOPRIGHT, 0.008, -0.02)
            BlzFrameSetPoint(minimap_border, FRAMEPOINT_BOTTOMLEFT, minimap, FRAMEPOINT_BOTTOMLEFT, -0.008, 0.019)
            BlzFrameSetVisible(minimap_border, false)
            PlayerUI.minimap_border = minimap_border
            --BlzFrameSetLevel(minimap_border, 0)

            --BlzFrameSetVisible(BlzFrameGetParent(BlzGetOriginFrame(ORIGIN_FRAME_MINIMAP_BUTTON, 0)), true)
            for i = 0, 4 do BlzFrameSetVisible(BlzGetOriginFrame(ORIGIN_FRAME_MINIMAP_BUTTON, i), true) end


            PlayerUI.gold_backdrop = CreateUIElement("DiabolicUI_UIButton_61x55_Normal", 0.581, 0.091, FRAMEPOINT_CENTER, 1., 0.095, 0.04, PlayerUI.action_bar)
            BlzFrameSetVisible(PlayerUI.gold_backdrop, false)
            local gold_text = BlzGetFrameByName("ResourceBarGoldText", 0)
            BlzFrameClearAllPoints(gold_text)
            BlzFrameSetAbsPoint(gold_text, FRAMEPOINT_CENTER, 0.57, 0.09)
            BlzFrameSetTextColor(gold_text, BlzConvertColor(255, 255, 255, 0))

            --RegisterScaler(PlayerUI.hp_globe, 0.119, 0.001)

            PlayerUI.level_up_frame = {}




        PlayerGlobeHpValue = {}
        PlayerGlobeMpValue = {}
        local level_up_timers = {}


        local start_levelup_scale = 0.8
        local end_levelup_scale = 0.55
        local scale_diff = start_levelup_scale - end_levelup_scale

        for i = 1, 6 do
            PlayerGlobeHpValue[i] = 100
            PlayerGlobeMpValue[i] = 100

            PlayerUI.level_up_frame[i] = BlzCreateFrameByType("BACKDROP", "level up name", GAME_UI, "", 0)
                BlzFrameSetVisible(PlayerUI.level_up_frame[i], false)
                BlzFrameSetAbsPoint(PlayerUI.level_up_frame[i], FRAMEPOINT_CENTER, 0.4, 0.4)
                BlzFrameSetSize(PlayerUI.level_up_frame[i], 0.8, 0.44)
                BlzFrameSetScale(PlayerUI.level_up_frame[i], start_levelup_scale)
                BlzFrameSetTexture(PlayerUI.level_up_frame[i], "UI\\".. GetLocalString("new_level_ru.blp", "new_level_en.blp"), 0, true)
                level_up_timers[i] = CreateTimer()
        end


        local rate = (2 / 0.05)
        LevelUpFrameTrigger = CreateTrigger()
        TriggerAddAction(LevelUpFrameTrigger, function()
            local player = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1

                if GetLocalPlayer() == Player(player-1) then
                    BlzFrameSetVisible(PlayerUI.level_up_frame[player], true)
                end

                BlzFrameSetScale(PlayerUI.level_up_frame[player], 0.7)
                BlzFrameSetAlpha(PlayerUI.level_up_frame[player], 0)

                local alpha = 0
                local scale = 0.7
                local alpha_delta = math.floor(255 / rate)
                local scale_delta = scale_diff / rate

                TimerStart(level_up_timers[player], 0.05, true, function()

                    alpha = alpha + alpha_delta
                    scale = scale - scale_delta
                    BlzFrameSetAlpha(PlayerUI.level_up_frame[player], alpha)

                    if scale <= end_levelup_scale then BlzFrameSetScale(PlayerUI.level_up_frame[player], end_levelup_scale)
                    else BlzFrameSetScale(PlayerUI.level_up_frame[player], scale) end

                        if alpha >= 255 then
                            alpha = 255
                            BlzFrameSetAlpha(PlayerUI.level_up_frame[player], alpha)
                            TimerStart(level_up_timers[player], 1., false, function()
                                alpha_delta = math.floor(255 / (1 / 0.05))
                                TimerStart(level_up_timers[player], 0.05, true, function()
                                    alpha = alpha - alpha_delta
                                    BlzFrameSetAlpha(PlayerUI.level_up_frame[player], alpha)
                                    if alpha <= 0 then
                                        TimerStart(level_up_timers[player], 0., false, nil)
                                        BlzFrameSetVisible(PlayerUI.level_up_frame[player], false)
                                    end
                                end)
                            end)
                        end

                end)

        end)

            PlayerUI.update_timer = CreateTimer()
            local update_step = 38 / (1. / 0.025)
            local time_delta = 0.3 / 0.025

            PlayerUI.level_bar = BlzGetFrameByName("SimpleHeroLevelBar", 0)
            TimerStart(PlayerUI.update_timer, 0.025, true, function()

                for i = 1, 6 do
                    if PlayerHero[i] then
                        local current_hp = GetUnitState(PlayerHero[i], UNIT_STATE_LIFE)
                        local max_hp = BlzGetUnitMaxHP(PlayerHero[i])

                        local current_mana = GetUnitState(PlayerHero[i], UNIT_STATE_MANA)
                        local max_mana = BlzGetUnitMaxMana(PlayerHero[i])

                        local current_hp_ratio = math.floor(((current_hp / max_hp) * 100.) + 0.5)
                        local current_mp_ratio = math.floor(((current_mana / max_mana) * 100.) + 0.5)
                        local globe_hp_value = math.floor(PlayerGlobeHpValue[i] + 0.5)
                        local globe_mp_value = math.floor(PlayerGlobeMpValue[i] + 0.5)

                        if globe_hp_value > 100 then globe_hp_value = 100 end
                        if globe_mp_value > 100 then globe_mp_value = 100 end


                            if current_hp_ratio ~= globe_hp_value then
                                update_step = ((current_hp_ratio - globe_hp_value) / time_delta) * 1.25

                                PlayerGlobeHpValue[i] = PlayerGlobeHpValue[i] + update_step
                                globe_hp_value = math.floor(PlayerGlobeHpValue[i] + 0.5)

                                if GetLocalPlayer() == Player(i - 1) then BlzFrameSetTexture(PlayerUI.hp_globe, hp_globe_textures[globe_hp_value], 0, true) end
                            elseif globe_hp_value == 0 then
                                PlayerGlobeHpValue[i] = 0
                                if GetLocalPlayer() == Player(i - 1) then BlzFrameSetTexture(PlayerUI.hp_globe, "UI\\globe_empty.blp", 0, true) end
                            elseif globe_hp_value == 100 then
                                PlayerGlobeHpValue[i] = 100
                                if GetLocalPlayer() == Player(i - 1) then BlzFrameSetTexture(PlayerUI.hp_globe, hp_globe_textures[100], 0, true) end
                            end


                            if current_mp_ratio ~= globe_mp_value then
                                update_step = ((current_mp_ratio - globe_mp_value) / time_delta) * 1.25

                                PlayerGlobeMpValue[i] = PlayerGlobeMpValue[i] + update_step
                                globe_mp_value = math.floor(PlayerGlobeMpValue[i] + 0.5)

                                if GetLocalPlayer() == Player(i - 1) then BlzFrameSetTexture(PlayerUI.mp_globe, mp_globe_textures[globe_mp_value], 0, true) end
                            elseif globe_mp_value == 0 then
                                PlayerGlobeMpValue[i] = 0
                                if GetLocalPlayer() == Player(i - 1) then BlzFrameSetTexture(PlayerUI.mp_globe, "UI\\globe_empty.blp", 0, true) end
                            elseif globe_mp_value == 100 then
                                PlayerGlobeMpValue[i] = 100
                                if GetLocalPlayer() == Player(i - 1) then BlzFrameSetTexture(PlayerUI.mp_globe, mp_globe_textures[100], 0, true) end
                            end


                            if GetLocalPlayer() == Player(i - 1) then
                                BlzFrameSetText(PlayerUI.hp_text_frame, math.floor(current_hp + 0.5) .. "/" .. max_hp)
                                BlzFrameSetText(PlayerUI.mp_text_frame, math.floor(current_mana + 0.5) .. "/" .. max_mana)
                                if BlzFrameGetValue(PlayerUI.level_bar) < 1. then BlzFrameSetValue(PlayerUI.xp_bar, BlzFrameGetValue(PlayerUI.level_bar) * 100.) end
                                BlzFrameSetText(PlayerUI.xp_bar_text, "|c00FF5A00" .. (GetHeroXP(PlayerHero[i]) - PlayerLastRequiredEXP[i]) .. "/".. (PlayerRequiredEXP[i] - PlayerLastRequiredEXP[i]) .. "|r")
                            end

                    end
                end

            end)


            PlayerUI.button_borders = {
                CreateUIBorder(GlobalButton[1].char_panel_button, 0.),
                CreateUIBorder(GlobalButton[1].skill_panel_button, 0.),
                CreateUIBorder(GlobalButton[1].inventory_panel_button, 0.),
                CreateUIBorder(GlobalButton[1].talents_panel_button, 0.),
                CreateUIBorder(GlobalButton[1].journal_panel_button, 0.),
                CreateUIBorder(GlobalButton[1].settings_panel_button, 0.)
            }

            for i = 1, 6 do BlzFrameSetVisible(PlayerUI.button_borders[i], false) end
            BlzFrameSetVisible(PlayerUI.xp_bar, false)


            PlayerUI.arrow = CreateSprite("UI\\arrow.mdx", 0.001, GlobalButton[1].skill_panel_button, FRAMEPOINT_BOTTOM, FRAMEPOINT_TOP, 0., 0.01, PlayerUI.button_borders[2])
            PlayerUI.arrow_ability_text = BlzCreateFrameByType("TEXT", "helper", PlayerUI.arrow, "StandardLabelTextTemplate", 0)
            BlzFrameSetFont(PlayerUI.arrow_ability_text, "D3font.ttf", 0.013, 0)
            BlzFrameSetText(PlayerUI.arrow_ability_text, GetLocalString("Выберите способности для использования", "Pick and bind abilities for use"))
            BlzFrameClearAllPoints(PlayerUI.arrow_ability_text)
            BlzFrameSetScale(PlayerUI.arrow_ability_text, 1.)
            BlzFrameSetPoint(PlayerUI.arrow_ability_text, FRAMEPOINT_TOPLEFT, PlayerUI.arrow, FRAMEPOINT_TOPRIGHT, 0.04, 0.1)
            BlzFrameSetTextAlignment(PlayerUI.arrow_ability_text, TEXT_JUSTIFY_CENTER, TEXT_JUSTIFY_MIDDLE)

            BlzFrameSetVisible(PlayerUI.arrow, false)
            BlzFrameSetVisible(PlayerUI.arrow_ability_text, false)

    end

end