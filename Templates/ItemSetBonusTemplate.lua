---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Stasik.
--- DateTime: 13.02.2020 14:07
---


    SetBonusList = {}


    function GetItemSet(id)
        return SetBonusList[id]
    end


    function NewItemSet(ref)
        SetBonusList[ref.id] = ref
    end



    function CountSetItems(unit, set)
        local unit_data = GetUnitData(unit)
        local count = 0

        for i = WEAPON_POINT, NECKLACE_POINT do
            local item_data = unit_data.equip_point[i]

            if item_data ~= nil then
                if item_data.set_bonus ~= nil and item_data.set_bonus.id == set.id then
                    count = count + 1
                end
            end

        end

        return count
    end


    function ApplySetBonus(unit, set_bonus, flag)
        local set_pieces = CountSetItems(unit, set_bonus)

            if flag then
                for i = #set_bonus.bonuses, 1, -1 do
                    if set_pieces + 1 == set_bonus.bonuses[i].pieces then
                        local params = set_bonus.bonuses[i].params
                            for key = 1, #params do
                                if params[key].param then ModifyStat(unit, params[key].param, params[key].value, params[key].method, flag)
                                else ApplyLegendaryEffect(unit, params[key].legendary_effect, flag) end
                            end
                        break
                    end
                end
            else
                for i = #set_bonus.bonuses, 1, -1 do
                    if set_pieces == set_bonus.bonuses[i].pieces then
                        local params = set_bonus.bonuses[i].params
                            for key = 1, #params do
                                if params[key].param then ModifyStat(unit, params[key].param, params[key].value, params[key].method, flag)
                                else ApplyLegendaryEffect(unit, params[key].legendary_effect, flag) end
                            end
                        break
                    end
                end
            end

    end


    function InitSetBonusTemplates()

        InitLegendaryEffects()

        NewItemSet({
            id = "STST",
            name = "Комплект легендарного тестера",
            bonuses = {
                { pieces = 2, params =
                    {
                        { param = HP_VALUE, value = 1000., method = STRAIGHT_BONUS }
                    }
                },
                { pieces = 4, params =
                    {
                        { param = MP_VALUE, value = 1000., method = STRAIGHT_BONUS },
                        { param = HP_VALUE, value = 1000., method = STRAIGHT_BONUS }
                    }
                }
            }
        })

        NewItemSet({
            id = "LOTA",
            name = LOCALE_LIST[my_locale].SET_NAME_ANCIENT_LEGACY, --"Наследие предков",
            bonuses = {
                { pieces = 2, params = {
                        { param = STR_STAT, value = 5, method = STRAIGHT_BONUS },
                        { param = ATTACK_SPEED, value = 10, method = STRAIGHT_BONUS }
                    }
                }
            }
        })

        NewItemSet({
            id = "KAJS",
            name = LOCALE_LIST[my_locale].SET_NAME_JESTERANDKING, --"Король и Шут",
            bonuses = {
                {
                    pieces = 2, params = {
                        { param = CRIT_CHANCE, value = 10, method = STRAIGHT_BONUS },
                        { param = CRIT_MULTIPLIER, value = 0.3, method = STRAIGHT_BONUS }
                    }
                }
            }
        })

        NewItemSet({
            id = "FMMA",
            name = "Угли и Искры",
            bonuses = {
                { pieces = 2, params = {
                        { param = FIRE_BONUS, value = 5, method = STRAIGHT_BONUS },
                        { param = FIRE_RESIST, value = 5, method = STRAIGHT_BONUS }
                    }
                },
                { pieces = 4, params = {
                        { param = HP_REGEN, value = 1.4, method = STRAIGHT_BONUS },
                        { param = MAGICAL_ATTACK, value = 1.4, method = MULTIPLY_BONUS }
                    }
                }
            }
        })


        NewItemSet({
            id = "FRBD",
            name = LOCALE_LIST[my_locale].SET_NAME_FIREBOND, --"Огненные узы",
            bonuses = {
                {
                    pieces = 2, params = {
                        { param = FIRE_BONUS, value = 5, method = STRAIGHT_BONUS },
                        { param = FIRE_RESIST, value = 12, method = STRAIGHT_BONUS },
                        { legendary_effect = GetLegendaryEffect("FRBD") },
                        --{ effect_name = "Все огненные заклинания наносят на 35%% больше урона.", effect_id = "FRBD", effect_type = ITEM_PASSIVE_EFFECT }
                    }
                },
            }
        })


        NewItemSet({
            id = "FRDL",
            name = LOCALE_LIST[my_locale].SET_NAME_FRENDLINESS, --"Приветливость",
            bonuses = {
                {
                    pieces = 2, params = {
                        { param = PHYSICAL_DEFENCE, value = 1.2, method = MULTIPLY_BONUS },
                        { param = REFLECT_DAMAGE, value = 125, method = STRAIGHT_BONUS }
                    }
                },
                {
                    pieces = 3, params = {
                        { param = REFLECT_DAMAGE, value = 1.4, method = MULTIPLY_BONUS },
                        { param = MAGICAL_SUPPRESSION, value = 1.2, method = MULTIPLY_BONUS }
                    }
                }
            }
        })



    end

