---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Stasik.
--- DateTime: 28.01.2020 9:26
---
do

    local PlayerNoiseTable
    local NOISE_FREQ_MIN = 1.5
    local NOISE_FREQ_MAX = 5.


    ---@param shake_x real
    ---@param shake_y real
    ---@param power real
    ---@param time real
    ---@param range real
    function ShakeByCoords(shake_x, shake_y, power, time, range)

        if time < 0.1 then time = 0.1 end
        if range < 50. then range = 50. end

            for i = 0, bj_MAX_PLAYERS do
                if GetLocalPlayer() == Player(i) then
                    if DistanceBetweenXY(GetCameraEyePositionX(), GetCameraEyePositionY(), shake_x or 0., shake_y or 0.) <= range then
                        table.insert(PlayerNoiseTable[i+1], { power = power, fade_power = power / (time / 0.1) })
                    end
                end
            end

    end



    function ShakerInit()

        PlayerNoiseTable = {}

        for i = 0, bj_MAX_PLAYERS do
            PlayerNoiseTable[i+1] = {  }
        end

        TimerStart(CreateTimer(), 0.1, true, function()

            for i = 0, bj_MAX_PLAYERS do
                if GetLocalPlayer() == Player(i) then
                    local total_power = 0
                    local playernum = i+1

                    for powercell = 1, #PlayerNoiseTable[playernum] do
                        total_power = total_power + PlayerNoiseTable[playernum][powercell].power
                    end

                    if total_power > 0. then
                        local velocity = total_power > NOISE_FREQ_MAX and NOISE_FREQ_MAX or total_power
                        if velocity < NOISE_FREQ_MIN then velocity = NOISE_FREQ_MIN end

                        velocity = total_power * velocity^10
                        total_power = total_power * 2.

                        CameraSetTargetNoiseEx(total_power, velocity, true)
                        CameraSetSourceNoiseEx(total_power, velocity, true)
                        CameraSetEQNoiseForPlayer(Player(i), total_power)
                    else
                        CameraSetSourceNoise(0., 0.)
                        CameraSetTargetNoise(0., 0.)
                    end

                    for k = 1, #PlayerNoiseTable[playernum] do
                        PlayerNoiseTable[playernum][k].power = PlayerNoiseTable[playernum][k].power - PlayerNoiseTable[playernum][k].fade_power
                    end

                    for k = 1, #PlayerNoiseTable[playernum] do
                        if PlayerNoiseTable[playernum][k].power <= 0. then table.remove(PlayerNoiseTable[playernum], k) end
                    end
                    
                end
            end

        end)

    end
    
end



