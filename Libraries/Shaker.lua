---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Stasik.
--- DateTime: 28.01.2020 9:26
---
do

    local PlayerNoiseTable = 0
    local NOISE_FREQ_MIN = 1.5
    local NOISE_FREQ_MAX = 5.


    ---@param shake_x real
    ---@param shake_y real
    ---@param power real
    ---@param time real
    ---@param range real
    function ShakeByCoords(shake_x, shake_y, power, time, range)

        --if true then return end

        if time < 0.1 then time = 0.1 end
        if range < 50. then range = 50. end

            for i = 1, 6 do
                --if GetLocalPlayer() == Player(i) then
                    if DistanceBetweenXY(GetUnitX(PlayerHero[i]), GetUnitY(PlayerHero[i]), shake_x or 0., shake_y or 0.) <= range then
                        table.insert(PlayerNoiseTable[i], { power = power, fade_power = power / (time / 0.1) })
                    end
                --end
            end

    end



    function ShakerInit()

        --if true then return end


        PlayerNoiseTable = {}

        for i = 1, 6 do
            PlayerNoiseTable[i] = {  }
        end

        local timer = CreateTimer()
        TimerStart(timer, 0.1, true, function()

            for i = 1, 6 do
                --if GetLocalPlayer() == Player(i) then
                    local total_power = 0

                    for powercell = 1, #PlayerNoiseTable[i] do
                        total_power = total_power + PlayerNoiseTable[i][powercell].power
                    end

                    if total_power > 0.1 then
                        local velocity = total_power > NOISE_FREQ_MAX and NOISE_FREQ_MAX or total_power
                        if velocity < NOISE_FREQ_MIN then velocity = NOISE_FREQ_MIN end

                        velocity = total_power * velocity^10
                        total_power = total_power * 2.

                        if GetLocalPlayer() == Player(i-1) then
                            CameraSetTargetNoiseEx(total_power, velocity, true)
                            CameraSetSourceNoiseEx(total_power, velocity, true)
                        end

                        --CameraSetEQNoiseForPlayer(Player(i-1), total_power)

                    else
                        if GetLocalPlayer() == Player(i-1) then
                            CameraSetSourceNoise(0., 0.)
                            CameraSetTargetNoise(0., 0.)
                        end
                    end

                    for k = 1, #PlayerNoiseTable[i] do
                        PlayerNoiseTable[i][k].power = PlayerNoiseTable[i][k].power - PlayerNoiseTable[i][k].fade_power
                    end

                    for k = 1, #PlayerNoiseTable[i] do
                        if PlayerNoiseTable[i][k].power <= 0. then table.remove(PlayerNoiseTable[i], k) end
                    end
                    
                --end
            end

        end)

    end
    
end



