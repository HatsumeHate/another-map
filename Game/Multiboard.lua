---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Stasik.
--- DateTime: 01.04.2020 6:58
---
do

    MAIN_MULTIBOARD = 0
    local PlayerColors = 0
    local PlayerNames = 0



    function TimeToText(time)
        local mins = R2I(math.floor(time / 60.) or 0.)
        local secs = time - (mins * 60.)

        if secs < 10 then secs = "0" .. I2S(R2I((secs)))
        else secs = I2S(R2I((secs))) end

        return LOCALE_LIST[my_locale].WAVE_COUNTDOWN .. mins .. ":" .. secs
    end



    function PlayerLeft(player)
        local gold = GetPlayerState(Player(player-1), PLAYER_STATE_RESOURCE_GOLD)
        local per_player = math.ceil(gold / ActivePlayers)

            MultiboardSetItemValue(MultiboardGetItem(MAIN_MULTIBOARD, 1 + player, 0), "|c006F6F6F" .. PlayerNames[player] .. "|r")
            SetPlayerState(Player(player-1), PLAYER_STATE_RESOURCE_GOLD, 0)
            --MultiboardSetItemValue(MultiboardGetItem(MAIN_MULTIBOARD, 1 + player, 1), "|c00FFFF00".."0".."|r")
            IssueImmediateOrderById(PlayerHero[player], order_stop)
            ShowUnit(PlayerHero[player], false)
            ShowQuestAlert(string.gsub(LOCALE_LIST[my_locale].PLAYER_LEFT, "#", PlayerNames[player]))

                if per_player > 0 then
                    for i = 1, 6 do
                        if PlayerHero[player] and not IsUnitHidden(PlayerHero[player]) then
                            SetPlayerState(Player(player-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(player-1), PLAYER_STATE_RESOURCE_GOLD) + per_player)
                        end
                    end
                end

    end


    ---@param name string
    function ParsePlayerName(name)
        local ending = string.find(name, "#")

        if ending then ending = ending - 1
        else ending = #name end

        return string.sub(name, 0, ending)
    end


    function InitMultiboard()

        PlayerColors = {
            [1] = "|c00FF0000",
            [2] = "|c000000FF",
            [3] = "|c0000FFFF",
            [4] = "|c0071007D",
            [5] = "|c00FFFF00",
            [6] = "|c00FF8B00",
        }

         PlayerNames = {
            [1] = "|c00FF0000",
            [2] = "|c000000FF",
            [3] = "|c0000FFFF",
            [4] = "|c0071007D",
            [5] = "|c00FFFF00",
            [6] = "|c00FF8B00",
        }

            MAIN_MULTIBOARD = CreateMultiboard()
            MultiboardSetTitleText(MAIN_MULTIBOARD, LOCALE_LIST[my_locale].WAVE_INCOMING_TEXT)
            MultiboardSetItemsStyle(MAIN_MULTIBOARD, true, false)
            MultiboardSetItemsWidth(MAIN_MULTIBOARD, 6.5 / 100.0)
            MultiboardSetColumnCount(MAIN_MULTIBOARD, 2)
            MultiboardSetRowCount(MAIN_MULTIBOARD, 8)
            MultiboardDisplay(MAIN_MULTIBOARD, true)


            --local minimap = BlzGetOriginFrame(ORIGIN_FRAME_MINIMAP, 0)
            local multiboard = BlzGetFrameByName("Multiboard", 0)
            BlzFrameClearAllPoints(multiboard)
            BlzFrameSetPoint(multiboard, FRAMEPOINT_TOPLEFT, PlayerUI.minimap_border, FRAMEPOINT_TOPRIGHT, 0.,0.)


            for i = 0, 4 do
                MultiboardSetItemValue(MultiboardGetItem(MAIN_MULTIBOARD, 1, i), "==================")
            end

            for i = 1, 6 do
                if GetPlayerSlotState(Player(i-1)) == PLAYER_SLOT_STATE_PLAYING then
                    PlayerNames[i] = ParsePlayerName(GetPlayerName(Player(i-1)))
                    MultiboardSetItemValue(MultiboardGetItem(MAIN_MULTIBOARD, 1 + i, 0), PlayerColors[i] .. PlayerNames[i] .. "|r")
                    --MultiboardSetItemWidth(MAIN_MULTIBOARD, 6.5 / 175.0)
                end
            end
            --MultiboardSetItemValue(MultiboardGetItem(MAIN_MULTIBOARD, 2, 0), )
            local timer = CreateTimer()
            TimerStart(timer, 2.25, true, function()
                for i = 1, 6 do
                    MultiboardSetItemValue(MultiboardGetItem(MAIN_MULTIBOARD, 1 + i, 1), "|c00FFFF00"..GetPlayerState(Player(i-1), PLAYER_STATE_RESOURCE_GOLD).."|r")
                end
            end)

            MultiboardSetItemWidth(MultiboardGetItem(MAIN_MULTIBOARD, 0, 1), 7. / 100.0)

    end

end