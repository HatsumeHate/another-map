---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Stasik.
--- DateTime: 01.04.2020 6:58
---
do

    MAIN_MULTIBOARD = nil




    function TimeToText(time)
        local mins = math.floor(time / 60.)
        local secs = time - (mins * 60.)

        return LOCALE_LIST[my_locale].WAVE_COUNTDOWN .. R2I(mins) .. ":" .. R2I(secs)
    end


    local function AddWaveTimer(total_time)
        local item = MultiboardGetItem(MAIN_MULTIBOARD, 1, 1)

        MultiboardSetItemStyle(item, true, false)
        MultiboardSetItemValue(item, TimeToText(total_time))
        TimerStart(WaveTimer, 0., false, nil)

        TimerStart(WaveTimer, 1., true, function()
            total_time = total_time - 1.
            MultiboardSetItemValue(item, TimeToText(total_time))

            if total_time <= 0. then
                PauseTimer(WaveTimer)
                SpawnMonsters()
                ToggleCitizens(false)
            end

        end)

    end


    local PlayerColors
    local PlayerNames

    function PlayerLeft(player)
        local gold = GetPlayerState(Player(player-1), PLAYER_STATE_RESOURCE_GOLD)
        local per_player = math.ceil(gold / ActivePlayers)

            MultiboardSetItemValue(MultiboardGetItem(MAIN_MULTIBOARD, 1 + player, 0), "|c006F6F6F" .. PlayerNames[player] .. "|r")
            SetPlayerState(Player(player-1), PLAYER_STATE_RESOURCE_GOLD, 0)
            --MultiboardSetItemValue(MultiboardGetItem(MAIN_MULTIBOARD, 1 + player, 1), "|c00FFFF00".."0".."|r")
            ShowUnit(PlayerHero[player], false)

                if per_player > 0 then
                    for i = 1, 6 do
                        if PlayerHero[player] and not IsUnitHidden(PlayerHero[player]) then
                            SetPlayerState(Player(player-1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(player-1), PLAYER_STATE_RESOURCE_GOLD) + per_player)
                        end
                    end
                end

    end


    function InitMultiboard()

        PlayerColors = {
            [1] = "|c00FF0000",
            [2] = "|c000000FF",
            [3] = "|c0000FFFF",
            [4] = "|c0071007D",
            [5] = "|c00FFFF00",
            [6] = "|c00FF8B00",
        }

         PlayerNames = {
            [1] = "|c00FF0000",
            [2] = "|c000000FF",
            [3] = "|c0000FFFF",
            [4] = "|c0071007D",
            [5] = "|c00FFFF00",
            [6] = "|c00FF8B00",
        }

            MAIN_MULTIBOARD = CreateMultiboard()
            MultiboardSetTitleText(MAIN_MULTIBOARD, LOCALE_LIST[my_locale].WAVE_INCOMING_TEXT)
            MultiboardSetItemsStyle(MAIN_MULTIBOARD, true, false)
            MultiboardSetItemsWidth(MAIN_MULTIBOARD, 6.5 / 100.0)
            MultiboardSetColumnCount(MAIN_MULTIBOARD, 2)
            MultiboardSetRowCount(MAIN_MULTIBOARD, 8)
            MultiboardDisplay(MAIN_MULTIBOARD, true)


            for i = 0, 4 do
                MultiboardSetItemValue(MultiboardGetItem(MAIN_MULTIBOARD, 1, i), "==================")
            end

            for i = 1, 6 do
                if GetPlayerSlotState(Player(i-1)) == PLAYER_SLOT_STATE_PLAYING then
                    PlayerNames[i] = GetPlayerName(Player(i-1))
                    MultiboardSetItemValue(MultiboardGetItem(MAIN_MULTIBOARD, 1 + i, 0), PlayerColors[i] .. PlayerNames[i] .. "|r")
                    --MultiboardSetItemWidth(MAIN_MULTIBOARD, 6.5 / 175.0)
                end
            end
            --MultiboardSetItemValue(MultiboardGetItem(MAIN_MULTIBOARD, 2, 0), )
            local timer = CreateTimer()
            TimerStart(timer, 2.25, true, function()
                for i = 1, 6 do
                    MultiboardSetItemValue(MultiboardGetItem(MAIN_MULTIBOARD, 1 + i, 1), "|c00FFFF00"..GetPlayerState(Player(i-1), PLAYER_STATE_RESOURCE_GOLD).."|r")
                end
            end)

    end

end