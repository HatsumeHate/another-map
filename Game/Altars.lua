---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by MSI.
--- DateTime: 13.05.2021 2:55
---
do



    local AltarEffects = {
        obelisk = {
            [1] = function(target)
                --print("pre YAY " .. GetUnitName(target))
                ApplyBuff(target, target, "A01G", 1)
                --print("YAY " .. GetUnitName(target))
            end
        },
        well_hp = {
            [1] = function(target)
                SetUnitState(target, UNIT_STATE_LIFE, GetUnitState(target, UNIT_STATE_MAX_LIFE))
            end
        },
        well_mp = {
            [1] = function(target)
                SetUnitState(target, UNIT_STATE_MANA, GetUnitState(target, UNIT_STATE_MAX_MANA))
            end
        }
    }


    AltarsList = {
        [FourCC("n00M")] = {
            recharge_time = 120.,
            effects = AltarEffects.obelisk
        },
        [FourCC("n00K")] = {
            recharge_time = 120.,
            effects = AltarEffects.obelisk
        },
        [FourCC("n00L")] = {
            recharge_time = 100.
        }
    }


    local function IsAHero(unit)

        for i = 1, 6 do
            if PlayerHero[i] ~= nil and PlayerHero[i] == unit then
                return true
            end
        end

        return false
    end



    function InitAltars()
        local trg = CreateTrigger()
        TriggerRegisterPlayerUnitEvent(trg, Player(0), EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER, nil)
        TriggerAddAction(trg, function()

            if GetUnitAbilityLevel(GetOrderTargetUnit(), FourCC("A01H")) <= 0 then return end
            local hero = GetTriggerUnit()

                if IsAHero(hero) and IsUnitInRange(hero, GetOrderTargetUnit(), 450.) then
                    local altar_unit = GetOrderTargetUnit()
                    local altar = AltarsList[GetUnitTypeId(altar_unit)]


                    UnitRemoveAbility(altar_unit, FourCC("A01H"))
                    --AltarEffects.obelisk[1](hero)
                    altar.effects[1](hero)

                    TimerStart(CreateTimer(), altar.recharge_time, false, function()
                        UnitAddAbility(altar_unit, FourCC("A01H"))
                        DestroyTimer(GetExpiredTimer())
                        altar_unit = nil
                    end)

                    altar = nil

                end

            hero = nil
        end)
    end





end